"use strict";var originLon,originLat,destinationLon,destinationLat,originFormEle=document.querySelector(".origin-form"),destinationFormEle=document.querySelector(".destination-form"),originUL=document.querySelector(".origins"),destinationUL=document.querySelector(".destinations"),buttonEle=document.querySelector(".plan-trip"),mapKey="pk.eyJ1Ijoic3VsYXlsaXUiLCJhIjoiY2thNWlrYmNnMDBpaDNsbm9lOHQ2MG5ncSJ9.iLbn-Tba_v8DH2S_ffwwDA",tranKey="1JEha51b8t7HwrkzlGmM";function removeTheSelectedList(t){t.querySelectorAll("li").forEach(function(t){t.classList.contains("selected")&&t.classList.remove("selected")})}function searchLocation(t,n){fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(t,".json?bbox=-97.325875,49.766204,-96.953987,49.99275&access_token=").concat(mapKey,"&limit=10")).then(function(t){if(t.ok)return t.json();throw new Error("There is an error on street name.")}).then(function(t){getStreetsList(t.features,n)})}function getStreetsList(t,n){var e="";n.innerHTML="",t.forEach(function(t){void 0!==t.properties.address&&(e+='\n        <li data-long="'.concat(t.center[0],'" data-lat="').concat(t.center[1],'">\n          <div class="name">').concat(t.text,"</div>\n          <div>").concat(t.properties.address,"</div>\n        </li>"))}),n.innerHTML=e}function GetTrip(t,n,e,i){fetch("https://api.winnipegtransit.com/v3/trip-planner.json?origin=geo/".concat(t,",").concat(n,"&api-key=").concat(tranKey,"&destination=geo/").concat(e,",").concat(i)).then(function(t){if(t.ok)return t.json();throw new Error("There is an error on getting trip.")}).then(function(t){TripplanHTML(t.plans[0].segments)})}function TripplanHTML(t){var n=document.querySelector(".my-trip"),e=n.innerHTML="";t.forEach(function(t){"walk"===t.type?void 0===t.to.stop?e+='<li>\n        <i class="fas fa-walking" aria-hidden="true"></i>\n        '.concat(t.type.capitalize()," for ").concat(t.times.durations.total," minutes\n        to your destination.\n      </li>"):e+='<li>\n        <i class="fas fa-walking" aria-hidden="true"></i>\n        '.concat(t.type.capitalize()," for ").concat(t.times.durations.total," minutes\n        to stop #").concat(t.to.stop.key," - ").concat(t.to.stop.name,"\n      </li>"):"ride"===t.type?e+='<li>\n        <i class="fas fa-bus" aria-hidden="true"></i>\n        '.concat(t.type.capitalize()," the ").concat(t.route.name?t.route.name:t.route.key," for ").concat(t.times.durations.total," minutes.\n      </li>"):"transfer"===t.type&&(e+='<li>\n      <i class="fas fa-ticket-alt" aria-hidden="true"></i>\n      '.concat(t.type.capitalize()," from stop #").concat(t.from.stop.key," - ").concat(t.from.stop.name," to stop #").concat(t.to.stop.key," - ").concat(t.to.stop.name,"\n    </li>"))}),n.innerHTML=e}originFormEle.addEventListener("submit",function(t){var n=t.target.querySelector("input").value;originLon=originLat=void 0,""!==n&&searchLocation(n,originUL),t.preventDefault()}),destinationFormEle.addEventListener("submit",function(t){var n=t.target.querySelector("input").value;destinationLat=destinationLon=void 0,""!==n&&searchLocation(n,destinationUL),t.preventDefault()}),originUL.addEventListener("click",function(t){var n=t.target.closest("li");removeTheSelectedList(originUL),n.classList.add("selected"),originLon=n.dataset.long,originLat=n.dataset.lat}),destinationUL.addEventListener("click",function(t){var n=t.target.closest("li");removeTheSelectedList(destinationUL),n.classList.add("selected"),destinationLon=n.dataset.long,destinationLat=n.dataset.lat}),buttonEle.addEventListener("click",function(t){void 0!==originLon&&void 0!==destinationLon&&(originLat==destinationLat&&originLon==destinationLon?alert("No need to move!"):GetTrip(originLat,originLon,destinationLat,destinationLon))}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};